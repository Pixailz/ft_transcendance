#!/bin/bash

# CONFIG
ENV_FILE="./.env"
VAR_TO_EDIT=(
	"ADMIN_USER"
	"ADMIN_PASS"
	"API42_USERID"
	"API42_SECRET"
	"API42_REDIRECTURL"
)
JWT_LEN="64"

function	install::env::replace_var()
{
	local	var_name="${1}"
	local	var_value="${2}"

	sed -i "s|${var_name}=\"\"|${var_name}=\"${var_value}\"|g" "${ENV_FILE}"
}

function	install::env()
{
	cp "${ENV_FILE}"{.template,}

	for var_name in ${VAR_TO_EDIT[@]}; do
		printf "\x1b[31m%s\x1b[00m > " "${var_name}"
		read choice
		install::env::replace_var "${var_name}" "${choice}"
	done

	JWT_PASS="$(head -c${JWT_LEN} /dev/urandom | xxd -ps -c ${JWT_LEN})"
	install::env::replace_var "JWT_SECRET" "${JWT_PASS}"
}

install::env
