name: CI

run-name: Main Caller for the CI

on:
  push:
    branches: [main]
  pull_request:

jobs:
  info:
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ’¬ github
        run: |+
          echo "Who launched: ${{ github.actor }}"
          echo "On branch:    ${{ github.ref_name }}"
          echo "Commit sha:   ${{ github.sha }}"
          echo "Vars"
          echo "SETUP_STR ${{ vars.SETUP_STR }}"

      - name: ðŸ’¬ docker | compose
        run: |+
          docker version
          docker compose version

  do-docker-prod:
    uses: ./.github/workflows/CI-docker.yaml
    with:
      mode: prod

  do-docker-dev:
    uses: ./.github/workflows/CI-docker.yaml
    with:
      mode: dev

  do-nest-prod:
    needs: do-docker-prod
    uses: ./.github/workflows/CI-nest.yaml
    with:
      mode: prod

  do-nest-dev:
    needs: do-docker-dev
    uses: ./.github/workflows/CI-nest.yaml
    with:
      mode: dev
